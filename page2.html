<!DOCTYPE html>
<html>
	<head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" type="text/css" href="index.css"/>
		<title>Uam~!!</title>
	</head>
	<body style="margin: 0 0 0 0">
        <div id="wrapper">
            <header>
                <div class="banner">우암 송시열</div>
                <nav id = "topMenu">
                    <ul>
                        <li><a href="/index.html">대문</a></li>
                        <li><a href="/page1.html?page=1">우암 송시열</a></li>
                        <li><a href="/page2.html">우암의 바위글씨</a></li>
                        <li style="border-right: black 1px solid;"><a href="#">연락처</a></li>
                    </ul>
                </nav>
            </header>
            <div class="contents" style="overflow:auto;">
                <div id="imgbox" style="height:700px;">
                </div>
                <div id="detail" style="height:700px;">
                
                </div>
                <div id="list">
                    <table id="bawi" cellpadding="0" cellspacing="0">
                        <tr>
                            <th>이름</th>
                            <th>주소</th>
                            <th></th>
                        </tr>
                        
                    </table>
                </div>
            </div>
        </div>
	</body>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript">
        var json1,json2;
        var img_num = 9;
        var pin_num = 0;
        var pin_len = 0;
        
        $.getJSON("json/page2/name.json", function(json) {
            console.log(json); // access the response object
            json1 = json;
            call_back();
        });
        function call_back(){
            $.getJSON("json/page2/coordinate.json", function(json) {
                console.log(json); // access the response object
                json2 = json;
                console.log(json1);
                put_img();
                put_detail();
            });
        }
        
        
        function put_img(){
            for(var i = 0; i < 17; i++){
                var img = document.createElement('img');
                var leftval = 300;
                var topval = 250;
                img.src = "/image/map/small/" + json1[i] + ".png";
                img.style = "left:"+(json2[i][0]*1 - leftval)+"px;top:"+(json2[i][1]*1 - topval)+"px;";
                document.getElementById("imgbox").appendChild(img);
            }
        }
        
        function put_detail(){
            var img = document.createElement('img');
            img.src = "/image/map/big/" + json1[img_num] + "_big.png";
            document.getElementById("detail").appendChild(img);
            console.log("json/page2/"+json1[img_num]+".json");
            $.getJSON("json/page2/"+json1[img_num]+".json", function(json) {
                pin_len = json.length;
                for(var i = 0; i < json.length; i++){
                    console.log("asdf");
                    var img2 = document.createElement('img');
                    if(i) img2.src = "/image/map/pin.png";
                    else img2.src = "/image/map/pin_select.png"
                    img2.style = "position:absolute;left:"+(json[i].location[0]*1)+"px;top:"+(json[i].location[1]*1+200)+"px;";
                    img2.addEventListener('mouseover',hover_event);
                    img2.addEventListener('mouseout',unhover_event);
                    img2.id = "pin"+i;
                    document.getElementById("detail").appendChild(img2);
                    add_row(json, i);
                }
            });
        }
        
        function add_row(obj, i) {
            var my_tbody = document.getElementById('bawi');
            var row = my_tbody.insertRow( my_tbody.rows.length ); // 하단에 추가
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = obj[i].name;
            cell2.innerHTML = obj[i].address;
            cell2.innerHTML = obj[i].address;
        }
        
        function hover_event(){
            var idx = $(this).attr('id').substr(3,1)*1;
            if(idx == pin_num) return;
            console.log($(this).attr('src'));
            $(this).attr('src',"/image/map/pin_hover.png");
        }
        function unhover_event(){
            for(var i = 0; i < pin_len; i++){
                if(i == pin_num){
                    $("#pin"+i).attr('src', "/image/map/pin_select.png");
                }
                else{
                    $("#pin"+i).attr('src', "/image/map/pin.png");
                }
            }
        }
    </script>
</html>